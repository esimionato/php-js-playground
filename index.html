<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>php|tek 2012 - Writing bad JavaScript with Mario!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="ryan@knplabs.com">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="js/html5.js"></script>
    <![endif]-->
</head>

<body>

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="#">php|tek JavaScript Playground</a>
            <div class="nav-collapse">
                <ul class="nav">
                    <li class="active"><a href="/">Home</a></li>
                    <li><a href="http://knpuniversity.com">KnpUniversity.com (shameless plug)</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </div>
</div>

<div class="container">

    <div class="row">
        <div class="span12">

            <div class="mario-world row-fluid">
                <div class="span8">
                    <div class="mario box">
                        .mario
                        <div class="luigi box">
                            .luigi
                            <div class="kick-butt">
                                <img src="images/luigi.gif" alt="Luigi, kicking ass" class="luigi-himself" />
                                <img src="images/fireball.gif" alt="fireball!" class="fireball" />
                                <img src="images/goomba.gif" alt="Enemy" class="enemy" />

                                <img src="images/bam.gif" alt="BAM!" class="bam-explode" />
                            </div>
                            <a href="#" class="peach box">
                                .peach
                            </a>
                        </div>
                    </div>
                </div>
                <div class="span4 log"></div>
            </div>

        </div>
    </div>

</div> <!-- /container -->

<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/jquery.js"></script>

<script type="text/javascript">
    // a global object we can use to store and namespace things
    window.MagicBoxes = function($container) {
        this.$el = $container;
        this.logCount = 0;

        this.initialize();
    };

    MagicBoxes.prototype.initialize = function() {
        // register the luigi click
        this.$el.find('.luigi').click(this._handleLuigiClick);

        // register the wrapper logging click
        this.$el.click(this._handleEventLogging);
    };

    MagicBoxes.prototype._handleLuigiClick = function(event) {
        // *almost* the same as returning false, but better, for one,
        // because it does not stop event propagation
        event.preventDefault();

        // luigi will be equal to this
        var $luigi = $(this);
        // alternatively, we could say
        // var $luigi = $(event.currentTarget);
        $luigi.addClass('active');

        var $fireball = $(this).find('.fireball');
        var $enemy = $(this).find('.enemy');
        var $bam = $(this).find('.bam-explode');

        $fireball.animate({
            left: '+=320'
        }, 1000, function() {
            $fireball.hide();
            $enemy.hide();
            $bam.show();

            setTimeout(function() {
                $luigi.removeClass('active');
                $fireball.css({left: '70px'});
                $fireball.show();
                $enemy.show();
                $bam.hide();
            }, 1000);
        });
    };

    MagicBoxes.prototype._handleEventLogging = function(event) {
        // handles the click on the whole wrapper to log events
        event.preventDefault();

        // print out some details about the event
        var $log = $(this).find('.log');

        // the logCount is temporarily broken! See my note below
        //var html = '<span class="badge badge-info">'+this.logCount+'</span>';
        var html = '<span class="badge badge-info">??</span>';
        html += '<span class="label">target:</span> .' + $(event.target).attr('class') + '<br/>';
        html += '<span class="label">currentTarget:</span> .' + $(event.currentTarget).attr('class') + '<br/>';
        html += '<span class="label">delegateTarget:</span> .' + $(event.delegateTarget).attr('class');

        $log.prepend('<div class="log-row">'+html+'</div>');

        // increase the local logCount variable
        // commented out - we now have a "scope" problem!
        // "this" is not this object, but the element that triggered the event callback
        // we'll see this in a second
        //this.logCount++;
    };

    jQuery(document).ready(function() {
        // initialize our little application
        var magicBoxApp = new MagicBoxes($('.mario-world'));
    });
</script>

</body>
</html>
